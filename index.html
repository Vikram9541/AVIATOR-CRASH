<!DOCTYPE html>
<html>
<head>
  <title>VStar Crash Game - Login/Register</title>
  <meta charset="UTF-8" />
  <style>
    body { font-family: Arial, sans-serif; text-align: center; background: #f0f0f0; padding: 50px; }
    input, button { padding: 10px; margin: 5px; width: 260px; }
    .box { background: white; padding: 30px; border-radius: 12px; display: inline-block; box-shadow: 0 0 10px gray; }
    .hidden { display: none; }
  </style>
</head>
<body>

<div class="box">
  <h2 id="formTitle">Login</h2>
  <input type="text" id="username" placeholder="Username" /><br/>
  <input type="password" id="password" placeholder="Password" /><br/>
  <input type="email" id="email" placeholder="Email (Signup Only)" class="hidden" /><br/>
  <input type="text" id="upi" placeholder="UPI ID (Signup Only)" class="hidden" /><br/>
  <button onclick="handleAction()" id="actionBtn">Login</button><br/>
  <small><a href="#" onclick="toggleForm()">Don't have an account? Register here</a></small>
  <h3 id="statusMsg"></h3>
</div>

<div class="box hidden" id="userBox">
  <h2 id="welcomeText"></h2>
  <p><b>Balance:</b> ₹0 <span id="userBalance"></span></p>
  <input type="number" id="depositAmount" placeholder="Deposit Amount" /><br/>
  <button onclick="requestDeposit()">Request Deposit</button><br/>
  <input type="text" id="withdrawUPI" placeholder="Your UPI ID" /><br/>
  <button onclick="requestWithdrawal()">Request Withdrawal</button><br/>
  <button onclick="logout()">Logout</button>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script>
  const firebaseConfig = {
    databaseURL: "https://aviator-crash-3fdcf-default-rtdb.firebaseio.com/"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  let isLogin = true;
  let currentUserKey = null;

  function toggleForm() {
    isLogin = !isLogin;
    document.getElementById("formTitle").innerText = isLogin ? "Login" : "Register";
    document.getElementById("actionBtn").innerText = isLogin ? "Login" : "Create Account";
    document.getElementById("email").classList.toggle("hidden", isLogin);
    document.getElementById("upi").classList.toggle("hidden", isLogin);
    document.getElementById("statusMsg").innerText = "";
  }

  function handleAction() {
    const username = document.getElementById("username").value.trim();
    const password = document.getElementById("password").value.trim();
    const email = document.getElementById("email").value.trim();
    const upi = document.getElementById("upi").value.trim();
    const ref = db.ref("VStar");

    if (isLogin) {
      ref.orderByChild("username").equalTo(username).once("value", snapshot => {
        let found = false;
        snapshot.forEach(child => {
          if (child.val().password === password) {
            currentUserKey = child.key;
            document.getElementById("statusMsg").innerText = "✅ Login successful!";
            showUserPanel(child.val());
            found = true;
          }
        });
        if (!found) document.getElementById("statusMsg").innerText = "❌ Invalid credentials";
      });
    } else {
      if (!username || !password || !email || !upi) {
        document.getElementById("statusMsg").innerText = "Please fill all fields.";
        return;
      }
      const userId = "user_" + Date.now();
      ref.push({
        user_id: userId,
        username, email, upi_id: upi,
        password,
        balance: 0,
        timestamp: new Date().toISOString()
      }, err => {
        if (err) {
          document.getElementById("statusMsg").innerText = "❌ Error creating account.";
        } else {
          document.getElementById("statusMsg").innerText = "✅ Account created. Please login.";
          toggleForm();
        }
      });
    }
  }

  function showUserPanel(user) {
    document.querySelector(".box").classList.add("hidden");
    const box = document.getElementById("userBox");
    box.classList.remove("hidden");
    document.getElementById("welcomeText").innerText = `Welcome, ${user.username}`;
    document.getElementById("userBalance").innerText = user.balance;
  }

  function requestDeposit() {
    const amt = parseInt(document.getElementById("depositAmount").value);
    if (!amt || amt <= 0) return alert("Enter valid deposit amount");
    alert("Send ₹" + amt + " to vikram95@kotak and wait for manual approval.");
  }

  function requestWithdrawal() {
    const upi = document.getElementById("withdrawUPI").value.trim();
    if (!upi) return alert("Enter valid UPI ID");
    alert("Withdrawal request sent! Admin will review and process manually.");
  }

  function logout() {
    currentUserKey = null;
    location.reload();
  }
</script>
</body>
</html>
