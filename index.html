<!DOCTYPE html><html>
<head>
  <meta charset="UTF-8" />
  <title>Crash Game Web</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getDatabase, ref, onValue, set, get, update, push } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";
    import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";const firebaseConfig = {
  apiKey: "AIzaSyAGn7jfjUuwHquYv0xEMWOo57kVm0EVzk8",
  authDomain: "aviator-crash-3fdcf.firebaseapp.com",
  databaseURL: "https://aviator-crash-3fdcf-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "aviator-crash-3fdcf",
  storageBucket: "aviator-crash-3fdcf.appspot.com",
  messagingSenderId: "181752775091",
  appId: "1:181752775091:web:d0ef4745359392a12f0bc6"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase();
const auth = getAuth();
const provider = new GoogleAuthProvider();

let userId = null;
let crashData = [3.13, 2.6, 1.07, 1.5, 4.4];
let historyIndex = 0;
let balance = 0;
let bet = 25;
let multiplier = 1.0;
let crashPoint = 2.0;
let locked = false;
let crashed = false;

const status = (msg) => document.getElementById("status").innerText = msg;

function updateUI() {
  document.getElementById("balance").innerText = `₹${balance}`;
  document.getElementById("bet").innerText = `Bet: ₹${bet}`;
}

document.getElementById("loginBtn").onclick = async () => {
  try {
    const result = await signInWithPopup(auth, provider);
    userId = result.user.uid;
    onAuthStateChanged(auth, async (user) => {
      if (user) {
        userId = user.uid;
        const balRef = ref(db, `users/${userId}/balance`);
        get(balRef).then(snapshot => {
          if (snapshot.exists()) {
            balance = snapshot.val();
          } else {
            set(balRef, 0);
          }
          updateUI();
          document.getElementById("game").style.display = "block";
          document.getElementById("loginBtn").style.display = "none";
        });
      }
    });
  } catch (err) {
    alert("Login failed");
  }
};

document.getElementById("increase").onclick = () => {
  if (bet + 25 <= balance) bet += 25;
  updateUI();
};
document.getElementById("decrease").onclick = () => {
  if (bet > 25) bet -= 25;
  updateUI();
};

document.getElementById("deposit").onclick = () => {
  alert("Send UPI payment to vikram95@kotak and wait for manual confirmation.");
};

document.getElementById("withdraw").onclick = () => {
  const amt = prompt("Enter amount to withdraw:");
  const upi = prompt("Enter your UPI ID:");
  if (amt && upi) {
    push(ref(db, `withdrawals/`), { userId, amt, upi });
    alert("Withdrawal request sent.");
  }
};

document.getElementById("betBtn").onclick = () => {
  if (locked || bet > balance) return;
  balance -= bet;
  locked = true;
  crashed = false;
  updateUI();
  status("Plane flying...");
  multiplier = 1.0;
  document.getElementById("plane").style.bottom = "0%";
  crashPoint = crashData[historyIndex % crashData.length];
  historyIndex++;
  startFlight();
};

document.getElementById("cashoutBtn").onclick = () => {
  if (!locked || crashed) return;
  locked = false;
  const win = Math.round(multiplier * bet);
  balance += win;
  set(ref(db, `users/${userId}/balance`), balance);
  updateUI();
  status(`Cashed out at ${multiplier.toFixed(2)}x for ₹${win}`);
};

function startFlight() {
  const plane = document.getElementById("plane");
  let m = 1.0;
  const int = setInterval(() => {
    multiplier = m;
    document.getElementById("multiplier").innerText = `${multiplier.toFixed(2)}x`;
    plane.style.bottom = `${Math.min(m * 15, 80)}%`;
    m += 0.05;
    if (m >= crashPoint) {
      clearInterval(int);
      status(`Crashed at ${crashPoint.toFixed(2)}x`);
      crashed = true;
      locked = false;
      if (userId) set(ref(db, `users/${userId}/balance`), balance);
    }
  }, 100);
}

  </script>
  <style>
    body { font-family: sans-serif; background: #111; color: white; text-align: center; }
    #game { display: none; margin-top: 20px; }
    button { padding: 10px; font-size: 16px; margin: 5px; }
    #plane { width: 100px; position: relative; transition: bottom 0.1s linear; }
    .small { font-size: 18px; }
  </style>
</head>
<body>
  <h1>Crash Game</h1>
  <button id="loginBtn">Login with Google</button>  <div id="game">
    <div id="status">Waiting...</div>
    <div id="balance">₹0</div>
    <div id="multiplier" class="small">1.00x</div>
    <img id="plane" src="assets/Flight.png" />
    <div>
      <button id="decrease">-25</button>
      <span id="bet" class="small">Bet: ₹25</span>
      <button id="increase">+25</button>
    </div>
    <div>
      <button id="betBtn">BET</button>
      <button id="cashoutBtn">CASHOUT</button>
    </div>
    <div>
      <button id="deposit">Deposit</button>
      <button id="withdraw">Withdraw</button>
    </div>
  </div>
</body>
</html>
